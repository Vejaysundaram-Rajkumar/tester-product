<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Metrics</title>
    <style>
        /* General layout styling */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f4f4f9;
        }

        .form-container {
            width: 95vw;
            height: 95vh;
            display: flex;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 10px;
            overflow: hidden;
        }

        /* Left side (categories and metrics) */
        .left-side {
            flex: 2;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
        }

        .category-box {
            background-color: #e0f7fa;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .category-box:hover {
            background-color: #b2ebf2;
        }

        /* Active/Selected Category Style */
        .category-box.selected {
            background-color: #00796b;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* Metrics Section (Bottom Left) */
        .metrics-container {
            margin-top: 20px;
            padding: 10px;
            background-color: #e3f2fd;
            height: 45vh;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            font-style: italic;
            text-align: center;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 25px;
            padding: auto;
            width: 130%;
        }

        .goal-container {
            background-color: #e0f7fa;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .goal-container:hover {
            background-color: #b2ebf2;
        }

        /* Active/Selected Metric Style */
        .goal-container.selected {
            background-color: #00796b;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* Right side (Selected metrics) */
        .right-side {
            flex: 1;
            background-color: #f0f4f7;
            padding: 10px;
            border-left: 2px solid #90caf9;
        }

        .selected-metrics-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .selected-metrics-list {
            list-style: none;
            padding: 0;
            overflow-y: auto;
        }

        .selected-metric-item.dragging {
            opacity: 0.5;
        }

        .delete-btn {
            background-color: #ff5252;
            border: none;
            color: white;
            padding: 5px;
            border-radius: 50%;
            cursor: pointer;
        }

        .delete-btn:hover {
            background-color: #ff1744;
        }

        .submit-btn-container {
        position:fixed;
        left: 640px;
        top:45px;
        width: 100%;   
        text-align: center;
        z-index: 100;
    }

    .submit-btn {
        padding: 10px 20px;
        background-color: #90caf9;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: not-allowed;
        opacity: 0.5;
        font-size: 16px;
    }

    .submit-btn.enabled {
        background-color: #1976d2;
        cursor: pointer;
        opacity: 1;
    }
        .priority-number {
    margin-right: 10px;
    background-color: #1976d2;
    color: white;
    padding: 5px 10px;
    border-radius: 50%;
    font-size: 14px;
    font-weight: bold;
    display: inline-block;
}
.selected-metric-item {
        position: relative;
        background-color: #f0f0f0;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
        cursor: move;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    </style>
    <script>
        var selectedMetrics = [];
        var selectedMetricsCount = 0;
        var maxMetrics = 10;
        var draggingItem = null;
    
        function showMetrics(category) {
            const metricGrid = document.getElementById('metric-grid');
            const placeholderMessage = document.getElementById('placeholder-message');
            const categories = document.querySelectorAll('.category-box');
    
            // Clear previous selection
            categories.forEach(cat => cat.classList.remove('selected'));
    
            // Highlight selected category
            const selectedCategoryBox = document.querySelector(`[onclick="showMetrics('${category}')"]`);
            selectedCategoryBox.classList.add('selected');
    
            // Clear existing metrics
            metricGrid.innerHTML = ''; 
            placeholderMessage.style.display = 'none';
    
            // Fetch the metrics for the selected category
            const metrics = document.getElementById(category + '_metrics').value.split(',');
    
            // Display metrics for the selected category
            metrics.forEach((metric) => {
                const metricElement = document.createElement('div');
                metricElement.classList.add('goal-container');
                metricElement.textContent = metric;
                metricElement.onclick = () => toggleMetricSelection(metric, metricElement);
                metricGrid.appendChild(metricElement);
            });
        }
    
        function toggleMetricSelection(metric, metricElement) {
            if (selectedMetrics.includes(metric)) {
                removeMetric(metric);
            } else {
                if (selectedMetricsCount >= maxMetrics) {
                    alert("You can select a maximum of " + maxMetrics + " metrics.");
                    return;
                }
                addMetric(metric, metricElement);
            }
        }
    
        function addMetric(metric, metricElement) {
            metricElement.classList.add('selected');
            selectedMetrics.push(metric);
            selectedMetricsCount++;
            addSelectedMetricToRightList(metric);
            updateSubmitButtonState();
        }
    
        function removeMetric(metric) {
            // Find the metric element in the grid based on its text content
            const gridMetricElements = document.querySelectorAll('.goal-container');
            gridMetricElements.forEach((element) => {
                if (element.textContent === metric) {
                    element.classList.remove('selected');
                }
            });
    
            selectedMetrics = selectedMetrics.filter(m => m !== metric);
            selectedMetricsCount--;
    
            // Remove from right-side list
            const rightMetricItem = document.querySelector(`.selected-metric-item[data-metric="${metric}"]`);
            if (rightMetricItem) {
                rightMetricItem.remove();
            }
    
            updatePriorities();
            updateSubmitButtonState();
        }
    
        function addSelectedMetricToRightList(metric) {
            const selectedMetricsList = document.getElementById('selected-metrics-list');
    
            const metricItem = document.createElement('li');
            metricItem.classList.add('selected-metric-item');
            metricItem.setAttribute('data-metric', metric);
            metricItem.draggable = true;
    
            // Add a priority number (ranking) next to the metric
            const priority = document.createElement('span');
            priority.classList.add('priority-number');
            priority.textContent = selectedMetrics.length;
    
            const deleteBtn = document.createElement('button');
            deleteBtn.classList.add('delete-btn');
            deleteBtn.textContent = 'X';
            deleteBtn.onclick = () => removeMetric(metric);
    
            metricItem.appendChild(priority);
            metricItem.appendChild(document.createTextNode(metric));
            metricItem.appendChild(deleteBtn);
            selectedMetricsList.appendChild(metricItem);
    
            // Add drag-and-drop functionality
            metricItem.addEventListener('dragstart', (e) => {
                draggingItem = metricItem;
                metricItem.classList.add('dragging');
            });
    
            metricItem.addEventListener('dragend', () => {
                draggingItem = null;
                metricItem.classList.remove('dragging');
                updatePriorities();
            });
    
            selectedMetricsList.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(selectedMetricsList, e.clientY);
                if (afterElement == null) {
                    selectedMetricsList.appendChild(draggingItem);
                } else {
                    selectedMetricsList.insertBefore(draggingItem, afterElement);
                }
            });
        }
    
        function updatePriorities() {
            const selectedMetricsList = document.getElementById('selected-metrics-list');
            const metricItems = selectedMetricsList.querySelectorAll('.selected-metric-item');
    
            selectedMetrics = [];  //resetting  the metrics list
    
            metricItems.forEach((item, index) => {
                const prioritySpan = item.querySelector('.priority-number');
                prioritySpan.textContent = index + 1;  
    
                // Update the selectedMetrics array to reflect the new order
                const metric = item.getAttribute('data-metric');
                selectedMetrics.push(metric);
            });
        }
    
        function updateSubmitButtonState() {
            const submitButton = document.getElementById('submit-btn');
            if (selectedMetricsCount === maxMetrics) {
                submitButton.classList.add('enabled');
                submitButton.disabled = false;
            } else {
                submitButton.classList.remove('enabled');
                submitButton.disabled = true;
            }
        }
    
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.selected-metric-item:not(.dragging)')];
    
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
    
        function submitForm() {
            const selectedMetricsInput = document.getElementById('selected-metrics-input');
            selectedMetricsInput.value = JSON.stringify(selectedMetrics);  //selected metrics into a string
        }
    </script>
    
</head>
<body>

<div class="form-container">
    <!-- Left Side: Categories and Metrics -->
    <div class="left-side">
        <h1>Parameters</h1>
        <div class="categories-grid">
            <!-- Dynamically Generated Categories -->
            {% for category, metrics in metrics_list.items() %}
                <div class="category-box" onclick="showMetrics('{{ category }}')">
                    {{ category }}
                </div>
                <!-- Hidden input to hold metrics for each category -->
                <input type="hidden" id="{{ category }}_metrics" value="{{ ','.join(metrics) }}">
            {% endfor %}
        </div>
        <h1>Metrics</h1>
        <div id="metrics-container" class="metrics-container">
            <p id="placeholder-message">Select a category to view metrics.</p>
            <div id="metric-grid" class="metric-grid"></div>
        </div>
    </div>

    <!-- Right Side: Selected Metrics -->
    <div class="right-side">
        <h2>Selected Metrics</h2>
        <ul id="selected-metrics-list"></ul>
    </div>        <!-- Submit button at the top of the page -->
<div class="submit-btn-container">
    <form method="POST" action="/" onsubmit="submitForm()">
        <input type="hidden" id="selected-metrics-input" name="selected_metrics">
        <button id="submit-btn" class="submit-btn" disabled>Submit</button>
    </form>
</div>

</div>

</body>
</html>
   